# 📊 Linuxコマンド `sar` の使い方まとめ

`sar`（System Activity Reporter）は、**CPU、メモリ、ディスク、ネットワークなどのシステムリソース使用状況を記録・表示**するためのコマンドです。  
パフォーマンスチューニングやトラブル調査で非常に役立ちます。

---

## ✅ 事前準備（インストール）

多くのディストリビューションでは `sysstat` パッケージに含まれています。

```bash
# Debian/Ubuntu 系
sudo apt install sysstat

# RHEL/CentOS/AlmaLinux 系
sudo dnf install sysstat
```

`sar` コマンドを定期実行するには `/etc/default/sysstat` や cron の設定を確認・有効化しておきます。

---

## 🔧 基本構文

```bash
sar [オプション] [間隔 [回数]]
```

例：10秒ごとに3回表示

```bash
sar -u 10 3
```

---

## 🔍 主なオプションと意味

| オプション | 内容                          |
|------------|-------------------------------|
| `-u`       | CPU使用率                     |
| `-r`       | メモリ使用量                  |
| `-b`       | I/O転送（ディスク）           |
| `-n DEV`   | ネットワークデバイスごとの統計 |
| `-q`       | Run Queue（ロードアベレージ） |
| `-d`       | 各ディスクの統計               |
| `-f`       | ログファイルから読み込み       |
| `-s` `-e`  | 時間範囲指定（開始・終了）     |

---

## 📈 使用例

### 1. CPU使用率をリアルタイム表示（10秒間隔で3回）

```bash
sar -u 10 3
```

出力例：

```
12:00:01 AM     CPU     %user   %nice %system %iowait  %idle
12:00:11 AM     all     10.50    0.00    1.25    0.50   87.75
```

---

### 2. メモリの統計

```bash
sar -r 1 5
```

➡️ 1秒間隔で5回メモリ情報を表示。

---

### 3. ディスクの使用状況

```bash
sar -d 1 3
```

➡️ ディスクごとの I/O 使用状況。

---

### 4. ネットワークデバイスの使用率

```bash
sar -n DEV 1 3
```

➡️ インターフェースごとの受信・送信バイトなど。

---

### 5. 過去のログ（例：7月4日のログ）

```bash
sar -u -f /var/log/sa/sa04
```

> `/var/log/sa/saXX` の `XX` は日付（04日なら `sa04`）

---

## ⏱ 時間指定で抽出（過去ログ）

```bash
sar -u -f /var/log/sa/sa04 -s 10:00:00 -e 12:00:00
```

➡️ 7月4日の10時〜12時のCPU統計

---

## 📂 ログの保存場所（標準設定）

- データ保存：`/var/log/sa/saXX`
- cronにより定期記録：`/etc/cron.d/sysstat` など

---

## 🧠 sarの応用Tips

- トラブルの**前後の傾向分析**ができる
- **過去のパフォーマンス履歴**を参照できる
- `sadf` を使えば CSV や JSON 形式にも出力可能：

```bash
sadf -d /var/log/sa/sa04 -- -u
```

---

## 🛠 よく使う組み合わせまとめ

| 内容              | コマンド例                     |
|-------------------|--------------------------------|
| CPU使用率         | `sar -u 1 5`                   |
| メモリ使用         | `sar -r 1 5`                   |
| ディスクI/O        | `sar -d 1 5`                   |
| ネットワーク       | `sar -n DEV 1 5`               |
| ロードアベレージ   | `sar -q 1 5`                   |
| 過去ログの確認     | `sar -u -f /var/log/sa/sa04`   |

---

📌 `sar` はリアルタイムにも過去ログにも強いです。  
パフォーマンス分析の強力な武器なので、ぜひ普段から使ってみてください！
